

<img src="./assets/logo.png" style="zoom: 30%;" />

# â€çƒ¹çƒ¹â€œ-PPengéƒ¨ç½²æ•™ç¨‹

> ä¸‹é¢æ‰€æœ‰ç¯å¢ƒçš„é…ç½®å®‰è£…ï¼Œä»¥åŠé¡¹ç›®çš„éƒ¨ç½²éƒ½å°†ä½¿ç”¨docker(é™¤äº†nginxå’Œsentinel)ï¼Œè¯·ç¡®ä¿æœåŠ¡å™¨ä¸Šå·²ç»å®‰è£…äº†docker

- [â€çƒ¹çƒ¹â€œ-PPengéƒ¨ç½²æ•™ç¨‹](#çƒ¹çƒ¹-ppengéƒ¨ç½²æ•™ç¨‹)
  - [é¡¹ç›®è¿è¡Œç¯å¢ƒé…ç½®](#é¡¹ç›®è¿è¡Œç¯å¢ƒé…ç½®)
    - [åˆ›å»ºdockerç½‘ç»œ](#åˆ›å»ºdockerç½‘ç»œ)
    - [redis:6.2.6](#redis626)
      - [docker å®‰è£…å‘½ä»¤](#docker-å®‰è£…å‘½ä»¤)
      - [è®¾ç½®ä¸´æ—¶å¯†ç ](#è®¾ç½®ä¸´æ—¶å¯†ç )
    - [rabbitmq:3-management](#rabbitmq3-management)
      - [docker å®‰è£…å‘½ä»¤](#docker-å®‰è£…å‘½ä»¤-1)
    - [mysql 8.0.32](#mysql-8032)
      - [my.cnf](#mycnf)
      - [docker å®‰è£…å‘½ä»¤](#docker-å®‰è£…å‘½ä»¤-2)
      - [åˆå§‹åŒ–æ•°æ®åº“](#åˆå§‹åŒ–æ•°æ®åº“)
    - [ElasticSearch:8.5.2](#elasticsearch852)
      - [docker å®‰è£…å‘½ä»¤](#docker-å®‰è£…å‘½ä»¤-3)
      - [é‡æ–°è®¾ç½®å¯†ç ](#é‡æ–°è®¾ç½®å¯†ç )
      - [è®¾ç½®ESç´¢å¼•çš„æ˜ å°„](#è®¾ç½®esç´¢å¼•çš„æ˜ å°„)
    - [nacos v2.2.0](#nacos-v220)
      - [docker å®‰è£…å‘½ä»¤](#docker-å®‰è£…å‘½ä»¤-4)
      - [åˆå§‹åŒ–nacos](#åˆå§‹åŒ–nacos)
    - [canal:latest](#canallatest)
      - [docker å®‰è£…å‘½ä»¤](#docker-å®‰è£…å‘½ä»¤-5)
      - [ç¼–è¾‘é…ç½®æ–‡ä»¶](#ç¼–è¾‘é…ç½®æ–‡ä»¶)
    - [sentinel:1.8.6](#sentinel186)
      - [è¿è¡Œå‘½ä»¤](#è¿è¡Œå‘½ä»¤)
    - [Nginx:1.18.0](#nginx1180)
      - [ç›¸å…³é…ç½®](#ç›¸å…³é…ç½®)
  - [é¡¹ç›®æ‰“åŒ…åŠéƒ¨ç½²](#é¡¹ç›®æ‰“åŒ…åŠéƒ¨ç½²)
    - [æ‰“åŒ…æˆjar](#æ‰“åŒ…æˆjar)
    - [æ‰“åŒ…æˆdockeré•œåƒ](#æ‰“åŒ…æˆdockeré•œåƒ)
    - [ä¾‹å­](#ä¾‹å­)


## é¡¹ç›®è¿è¡Œç¯å¢ƒé…ç½®

> æ‰€é…ç½®çš„ç¯å¢ƒåŒ…æ‹¬ï¼š
>
> - redis
> - rabbitmq
> - mysql
> - elasticsearch
> - nacos
> - canal
> - sentinel
> - nginx



### åˆ›å»ºdockerç½‘ç»œ

```sh
docker network create ppeng_net
```



### redis:6.2.6 

#### docker å®‰è£…å‘½ä»¤

```sh
docker run -d --network ppeng_net \
-p 6379:6379 \
--privileged=true \
-v /home/redis/data:/data \
--name=redis redis:6.2.6
```

#### è®¾ç½®ä¸´æ—¶å¯†ç 

> ps:è®¾ç½®æ°¸ä¹…å¯†ç é€šè¿‡redisé…ç½®æ–‡ä»¶è®¾ç½®

```sh
# è¿›å…¥rediså®¹å™¨
docker exec -it redis bash
# è¿æ¥redis
redis-cli
# è®¾ç½®å¯†ç 
config set requirepass rediså¯†ç 
```



### rabbitmq:3-management  

> `rabbitmq:3-management` ç‰ˆæœ¬å·ä¸­æœ‰å¸¦`management`çš„æ˜¯æ‹¥æœ‰å›¾å½¢åŒ–ç®¡ç†é¢æ¿çš„
>
> ä¸‹åˆ—å‚æ•°è¯·è‡ªè¡Œè®¾ç½®
>
> - `RABBITMQ_DEFAULT_PASS` ä¸ºé»˜è®¤ç”¨æˆ·çš„å¯†ç 

#### docker å®‰è£…å‘½ä»¤

```sh
docker run -d  --network ppeng_net \
-p 15672:15672 \
-p 5672:5672 \
--name rabbitmq \
-e RABBITMQ_DEFAULT_USER=ppeng \
-e RABBITMQ_DEFAULT_PASS=é»˜è®¤ç”¨æˆ·å¯†ç  rabbitmq:3-management
```



### mysql 8.0.32

#### my.cnf

[my.cnf](./data/mysql/my.cnf) =>è¯·å°†`my.cnf`æ”¾ç½®åˆ°`/home/mysql/conf/`æ–‡ä»¶å¤¹ä¸‹

ps: å¦‚æœä½ æƒ³è¦æ”¾ç½®åˆ°å…¶ä»–ä½ç½®ï¼Œè¯·ä¿®æ”¹ä¸‹åˆ—çš„dockerå‘½ä»¤ä¸­æ•°æ®å·æŒ‚è½½ä½ç½®

#### docker å®‰è£…å‘½ä»¤

> ä¸‹åˆ—å‚æ•°è¯·è‡ªè¡Œè®¾ç½®
>
> - `MYSQL_ROOT_PASSWORD` mysqlå¯†ç 

```sh
docker run -d --network ppeng_net \
-p 3306:3306 \
--privileged=true \
-v /home/mysql/log:/var/log/mysql \
-v /home/mysql/data:/var/lib/mysql \
-v /home/mysql/conf/my.cnf:/etc/mysql/my.cnf \
-e MYSQL_ROOT_PASSWORD=mysqlå¯†ç  --name=mysql mysql:8.0.32
```



#### åˆå§‹åŒ–æ•°æ®åº“

- åˆå§‹åŒ–`db_ppeng`æ•°æ®åº“

  [db_ppeng.sql](./data/mysql/db_ppeng.sql) => åœ¨åˆ›å»º`db_ppeng`æ•°æ®åº“åæ‰§è¡Œè¯¥æ–‡ä»¶

- åˆå§‹åŒ–`db_nacos`æ•°æ®åº“

  [db_nacos.sql](./data/mysql/db_nacos.sql) => åœ¨åˆ›å»º`db_nacos`æ•°æ®åº“åæ‰§è¡Œè¯¥æ–‡ä»¶

- åˆ›å»ºç”¨æˆ·

  > ä¸‹åˆ—å‚æ•°è¯·è‡ªè¡Œè®¾ç½®
  >
  > - nacosç”¨æˆ·å¯†ç 
  > - canalç”¨æˆ·å¯†ç 

  ```sql
  /*
      é…ç½®nacosç”¨æˆ·
   */
  CREATE DATABASE IF NOT EXISTS db_nacos;
  
  -- åˆ›å»ºåä¸º nacosçš„ç”¨æˆ·ï¼Œæ’ä»¶ä¸º mysql_native_password(é’ˆå¯¹mysql 8+)
  CREATE USER 'nacos'@'%' IDENTIFIED WITH mysql_native_password BY 'nacosç”¨æˆ·å¯†ç ';
  
  -- æˆæƒ nacos ç”¨æˆ·è®¿é—® db_nacos æ•°æ®åº“
  GRANT ALL PRIVILEGES ON db_nacos.* TO 'nacos'@'%';
  
  /*
    é…ç½®canalç”¨æˆ·
   */
  CREATE DATABASE IF NOT EXISTS db_ppeng;
  
  -- åˆ›å»ºåä¸º canal çš„ç”¨æˆ·ï¼Œæ’ä»¶ä¸º mysql_native_password(é’ˆå¯¹mysql 8+)
  CREATE USER 'canal'@'%' IDENTIFIED WITH mysql_native_password BY 'canalç”¨æˆ·å¯†ç ';
  
  -- æˆæƒ canal ç”¨æˆ·
  GRANT SELECT, REPLICATION SLAVE, REPLICATION CLIENT, SHOW VIEW ON *.* TO `canal`@`%`
  ```

  



### ElasticSearch:8.5.2

#### docker å®‰è£…å‘½ä»¤

> ç”±äºè®¾ç½®äº†`xpack.security.http.ssl.enabled=false`
>
> ----å–æ¶ˆhttpsè¿æ¥ï¼Œæ‰€ä»¥ESå¯†ç æ— æ³•ç›´æ¥æ˜¾ç¤ºåœ¨æ§åˆ¶å°ï¼Œå› æ­¤éœ€è¦é‡æ–°è®¾ç½®å¯†ç 

```sh
docker run --name es --network ppeng_net \
-p 9200:9200 -p 9300:9300 \
-e "discovery.type=single-node" \
-e "ES_JAVA_OPTS=-Xms512m -Xmx512m" \
-e "xpack.security.http.ssl.enabled=false" \
-v /home/es/plugins:/usr/share/elasticsearch/plugins \
-d elasticsearch:8.5.2
```

#### é‡æ–°è®¾ç½®å¯†ç 

è¿›å…¥ESå®¹å™¨

```sh
docker exec -it es bash
```

æ‰§è¡Œé‡æ–°è®¾ç½®å¯†ç å‘½ä»¤

> auto - ä½¿ç”¨éšæœºç”Ÿæˆçš„å¯†ç 
> interactive - ä½¿ç”¨ç”¨æˆ·è¾“å…¥çš„å¯†ç 

```sh
./bin/elasticsearch-setup-passwords auto
```



#### è®¾ç½®ESç´¢å¼•çš„æ˜ å°„

```json
PUT /recipe
{
  "mappings": {
    "properties": {
      "combind": {
        "type": "text",
        "analyzer": "ik_max_word",
        "search_analyzer": "ik_smart"
      },
      "id": {
        "type": "long"
      },
      "userId": {
        "type": "long"
      },
      "typeId": {
        "type": "integer"
      },
      "title": {
        "type": "text",
        "analyzer": "ik_max_word",
        "search_analyzer": "ik_smart",
        "copy_to": "combind"
      },
      "material": {
        "type": "text"
      },
      "content": {
        "type": "text",
        "analyzer": "ik_max_word",
        "search_analyzer": "ik_smart",
        "copy_to": "combind"
      },
      "mediaUrl": {
        "type": "text"
      },
      "isVideo": {
        "type": "integer"
      },
      "isProfessional": {
        "type": "integer"
      },
      "likes": {
        "type": "integer"
      },
      "collections": {
        "type": "integer"
      },
      "createTime": {
        "type": "date"
      },
      "updateTime": {
        "type": "date"
      }
    }
  }
}

```





### nacos v2.2.0  

#### docker å®‰è£…å‘½ä»¤

> ä¸‹åˆ—å‚æ•°è¯·è‡ªè¡Œè®¾ç½®
>
> - `MYSQL_SERVICE_HOST` mysqlçš„IPåœ°å€ï¼Œåœ¨åŒä¸€dockerç½‘ç»œä¸‹ï¼Œå¡«å®¹å™¨åå³å¯
> - `MYSQL_SERVICE_PASSWORD` ä¸Šé¢è®¾ç½®çš„nacosç”¨æˆ·å¯†ç 

```sh
docker run --name nacos -d --network ppeng_net \
-p 7744:8848 \
-p 8744:9848 \
-p 8745:9849 \
--privileged=true \
--restart=always \
-e MODE=standalone \
-e PREFER_HOST_MODE=hostname \
-e SPRING_DATASOURCE_PLATFORM=mysql \
-e MYSQL_SERVICE_HOST=mysql \
-e MYSQL_SERVICE_DB_NAME=db_nacos \
-e MYSQL_SERVICE_PORT=3306 \
-e MYSQL_SERVICE_USER=nacos \
-e MYSQL_SERVICE_PASSWORD=nacosç”¨æˆ·å¯†ç  \
-e TIME_ZONE='Asia/Shanghai' \
-v /home/nacos/logs:/home/nacos/logs \
nacos/nacos-server:v2.2.0
```

#### åˆå§‹åŒ–nacos

1. è¿›å…¥nacosæ§åˆ¶å°ï¼Œé»˜è®¤ç”¨æˆ·åä¸º`ppeng`ï¼Œé»˜è®¤å¯†ç ä¸º`nacos`ã€‚

2. ç‚¹å‡»å‘½åç©ºé—´ï¼Œåˆ›å»ºæ–°çš„å‘½åç©ºé—´

   <img src="./assets/nacos/åˆ›å»ºå‘½åç©ºé—´.png" style="zoom:50%;" />

3. ä¿®æ”¹`./data/nacos_config/PPENG_GROUP`ä¸­çš„é…ç½®æ–‡ä»¶ï¼Œè¡¥å……æ‰€æœ‰æœ‰`TODO`æ ‡è¯†çš„å†…å®¹

   ä¾‹å¦‚ï¼šelasticSearch.yamlæ–‡ä»¶

   ```yaml
   spring:
     elasticsearch:
       uris: es:9200           #TODO æ¢æˆä½ çš„ElasticSearchåœ°å€ï¼Œåœ¨åŒä¸€dockerç½‘ç»œä¸‹ï¼Œå¡«å†™å®¹å™¨å:é»˜è®¤ç«¯å£å³å¯
       username: elastic
       password:       #TODO æ¢æˆä½ çš„Elasticç”¨æˆ·å¯†ç 
   ```

4. å°†`PPENG_GROUP`æ–‡ä»¶å¤¹å‹ç¼©ï¼Œç‚¹å‡»nacosæ§åˆ¶å°ä¸­çš„`é…ç½®ç®¡ç†`,è¿›å…¥`é…ç½®åˆ—è¡¨`ï¼Œé€‰æ‹©`PPeng`å‘½åç©ºé—´ï¼Œç„¶å å¯¼å…¥é…ç½®

   > æ³¨æ„ï¼šå¯¼å…¥çš„æ˜¯`PPENG_GROUP.zip`

   <img src="./assets/nacos/å¯¼å…¥é…ç½®.png" style="zoom:50%;" />







### canal:latest

#### docker å®‰è£…å‘½ä»¤

> ä¸‹åˆ—å‚æ•°è¯·è‡ªè¡Œè®¾ç½®
>
> - `canal.instance.master.address` mysqlçš„IPåœ°å€ä»¥åŠç«¯å£ï¼Œåœ¨åŒä¸€dockerç½‘ç»œä¸‹ï¼Œå¡«å®¹å™¨åå³å¯
> - `canal.instance.dbPassword` ä¸Šé¢è®¾ç½®çš„canalç”¨æˆ·å¯†ç 

```sh
docker run -d --network ppeng_net \
-p 11111:11111  \
-e canal.destinations=db_ppeng \
-e canal.instance.master.address=mysql:3306  \
-e canal.instance.dbUsername=canal  \
-e canal.instance.dbPassword=canalç”¨æˆ·å¯†ç   \
-e canal.instance.connectionCharset=UTF-8 \
-e canal.instance.tsdb.enable=true \
-e canal.instance.gtidon=false  \
-e canal.instance.filter.regex=db_ppeng\\..* \
--name canal canal/canal-server
```

#### ç¼–è¾‘é…ç½®æ–‡ä»¶

è¿›å…¥canalå®¹å™¨å†…éƒ¨

```sh
docker exec -it canal bash
```



ç¼–è¾‘`canal.properties`æ–‡ä»¶

```sh
vi /home/admin/canal-server/conf/canal.properties
```

ä¿®æ”¹ä¸‹åˆ—ä½ç½®ï¼š

> ä¸‹åˆ—å‚æ•°è¯·è‡ªè¡Œè®¾ç½®
>
> - `rabbitmq.host` rabbitMQçš„IPåœ°å€ï¼Œåœ¨åŒä¸€dockerç½‘ç»œä¸‹ï¼Œå¡«å®¹å™¨åå³å¯
> - `rabbitmq.password` ä¸Šé¢è®¾ç½®çš„RabbitMQé»˜è®¤ç”¨æˆ·å¯†ç 

```properties
# é€‰æ‹©RabbitMQæ¨¡å¼
canal.serverMode = rabbitMQ
##################################################
#########                   RabbitMQ         #############
##################################################
rabbitmq.host =rabbitmq
rabbitmq.virtual.host =/
rabbitmq.exchange =ppeng.topic.exchange
rabbitmq.username =ppeng
rabbitmq.password =é»˜è®¤ç”¨æˆ·å¯†ç 
rabbitmq.deliveryMode =topic
```



ç¼–è¾‘`instance.properties`æ–‡ä»¶

```sh
vi /home/admin/canal-server/conf/db_ppeng/instance.properties
```

ä¿®æ”¹ä¸‹åˆ—ä½ç½®ï¼š

```properties
canal.mq.topic=canal.data
```

é‡å¯å®¹å™¨ï¼š

```sh
docker restart canal
```



å†æ¬¡è¿›å…¥å®¹å™¨æŸ¥çœ‹

```sh
cat /home/admin/canal-server/logs/db_ppeng/db_ppeng.log
```

å‡ºç°ä»¥ä¸‹æç¤ºå³ä¸ºæˆåŠŸï¼š

```bash
2023-05-17 18:20:44.786 [destination = db_ppeng , address = mysql/172.18.0.2:3306 , EventParser] WARN  c.a.o.c.p.inbound.mysql.rds.RdsBinlogEventParserProxy - ---> begin to find start position, it will be long time for reset or first position
2023-05-17 18:20:44.786 [destination = db_ppeng , address = mysql/172.18.0.2:3306 , EventParser] WARN  c.a.o.c.p.inbound.mysql.rds.RdsBinlogEventParserProxy - prepare to find start position just show master status
2023-05-17 18:20:45.224 [destination = db_ppeng , address = mysql/172.18.0.2:3306 , EventParser] WARN  c.a.o.c.p.inbound.mysql.rds.RdsBinlogEventParserProxy - ---> find start position successfully, EntryPosition[included=false,journalName=mysql-bin.000005,position=4,serverId=1000,gtid=<null>,timestamp=1684318348000] cost : 417ms , the next step is binlog dump
```



### sentinel:1.8.6

> ä¸‹è½½åœ°å€ï¼šhttps://github.com/alibaba/Sentinel/releases/download/1.8.6/sentinel-dashboard-1.8.6.jar
>

#### è¿è¡Œå‘½ä»¤

> ä¸‹åˆ—å‚æ•°è¯·è‡ªè¡Œè®¾ç½®
>
> - `-Dsentinel.dashboard.auth.password` Sentinelå¯†ç 

```sh
nohup java -Dserver.port=8182 -Dcsp.sentinel.dashboard.server=localhost:8182 -Dproject.name=sentinel-dashboard -Dsentinel.dashboard.auth.username=ppeng -Dsentinel.dashboard.auth.password=Sentinelå¯†ç  -jar sentinel-dashboard-1.8.6.jar >temp.logÂ &
```



### Nginx:1.18.0

> å®‰è£…è¿‡ç¨‹ã€‚ã€‚ã€‚ç•¥

#### ç›¸å…³é…ç½®

> æ³¨æ„æ›¿æ¢è‡ªå·±çš„åŸŸåå’ŒSSLè¯ä¹¦ä½ç½®

```nginx
    server {
        listen *:80;
        listen *:443 ssl; 
        listen [::]:80;
        listen [::]:443 ssl;
        server_name www.ppeng.zhub.fun;

        ssl_certificate /etc/letsencrypt/live/ppeng.zhub.fun/fullchain.pem; 
        ssl_certificate_key /etc/letsencrypt/live/ppeng.zhub.fun/privkey.pem; 

        return 301 https://ppeng.zhub.fun$request_uri;
    }

    server {
        listen *:80;
        listen [::]:80;
        server_name ppeng.zhub.fun;
        return 301 https://ppeng.zhub.fun$request_uri;
    }

    server {
        listen *:443 ssl; 
        listen [::]:443 ssl; 
        server_name ppeng.zhub.fun;      
              
        ssl_certificate /etc/letsencrypt/live/ppeng.zhub.fun/fullchain.pem; 
        ssl_certificate_key /etc/letsencrypt/live/ppeng.zhub.fun/privkey.pem; 
  
  			location /v1/api/ {
            default_type  application/json;
            #internal;  
            keepalive_timeout   30s;  
            keepalive_requests  1000;  
            #æ”¯æŒkeep-alive  
            proxy_http_version 1.1;  
            rewrite /v1/api(/.*) $1 break;  
            proxy_pass_request_headers on;
            #more_clear_input_headers Accept-Encoding;  
            proxy_next_upstream error timeout;  
	    			client_max_body_size 1024m;
            proxy_pass http://localhost:6378;
        }
  
          location /resource/ {
					client_max_body_size 1024m;
            root "/home/ppeng/";
        }

        location / {
            return 404;
        }
        
    }
```





## é¡¹ç›®æ‰“åŒ…åŠéƒ¨ç½²

> åç«¯ä»£ç å°†é€šè¿‡Mavenè¿›è¡Œæ‰“åŒ…æˆjaråŒ…ï¼Œç„¶åä½¿ç”¨Dockerfileæ–‡ä»¶æ‰“åŒ…æˆç›¸åº”çš„dockeré•œåƒï¼Œå®ç°å®¹å™¨åŒ–éƒ¨ç½²



### æ‰“åŒ…æˆjar

ä½¿ç”¨IDEAå°±èƒ½å¾ˆè½»æ¾çš„ä½¿ç”¨Mavenå®Œæˆè¿™æ­¥æ“ä½œï¼Œæ‰€ä»¥ï¼š

ç•¥ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚



### æ‰“åŒ…æˆdockeré•œåƒ

åœ¨`./data/Dockerfile`æ–‡ä»¶å¤¹ä¸­å·²ç»ç¼–å†™å¥½äº†æ‰€æœ‰æ¨¡å—çš„Dockerfileæ–‡ä»¶ï¼Œåªéœ€è¦å°†æ‰“åŒ…å¥½çš„jaråŒ…å’Œå¯¹åº”çš„Dockerfileæ–‡ä»¶æ”¾åœ¨**åŒä¸€æ–‡ä»¶å¤¹**å†…ï¼Œå³å¯æ„å»ºdockeré•œåƒ.



æ¨èå°†é¡¹ç›®ä¿å­˜åœ¨`/home/ppeng`æ–‡ä»¶å¤¹ä¸­ï¼Œå…·ä½“ç›®å½•ç»“æ„å¦‚ä¸‹ï¼š

```sh
root@czkubuntu:/home/ppeng# tree -L 2
.
â”œâ”€â”€ logs
â”‚   â”œâ”€â”€ ppeng-admin
â”‚   â”œâ”€â”€ ppeng-gateway
â”‚   â”œâ”€â”€ ppeng-message
â”‚   â”œâ”€â”€ ppeng-other-api
â”‚   â”œâ”€â”€ ppeng-recipe
â”‚   â”œâ”€â”€ ppeng-search
â”‚   â””â”€â”€ ppeng-user
â”œâ”€â”€ ppeng-admin
â”‚   â”œâ”€â”€ Dockerfile
â”‚   â””â”€â”€ ppeng-module-admin-1.0-SNAPSHOT.jar
â”œâ”€â”€ ppeng-gateway
â”‚   â”œâ”€â”€ Dockerfile
â”‚   â””â”€â”€ ppeng-module-gateway-1.0-SNAPSHOT.jar
â”œâ”€â”€ ppeng-message
â”‚   â”œâ”€â”€ Dockerfile
â”‚   â””â”€â”€ ppeng-module-message-1.0-SNAPSHOT.jar
â”œâ”€â”€ ppeng-other-api
â”‚   â”œâ”€â”€ Dockerfile
â”‚   â””â”€â”€ ppeng-other-api-1.0-SNAPSHOT.jar
â”œâ”€â”€ ppeng-recipe
â”‚   â”œâ”€â”€ Dockerfile
â”‚   â””â”€â”€ ppeng-module-recipe-1.0-SNAPSHOT.jar
â”œâ”€â”€ ppeng-search
â”‚   â”œâ”€â”€ Dockerfile
â”‚   â””â”€â”€ ppeng-module-search-1.0-SNAPSHOT.jar
â”œâ”€â”€ ppeng-user
â”‚   â”œâ”€â”€ Dockerfile
â”‚   â””â”€â”€ ppeng-module-user-1.0-SNAPSHOT.jar
â””â”€â”€ resource
    â”œâ”€â”€ icon
    â””â”€â”€ recipe
```

ç›®å½•ç»“æ„è¯´æ˜ï¼š

- `logs`

  å­˜æ”¾å„ä¸ªæ¨¡å—çš„æ—¥å¿—æ–‡ä»¶

- `ppeng-admin`

  å­˜æ”¾`ppeng-admin`æ¨¡å—çš„jaråŒ…å’Œå¯¹åº”çš„`Dockerfile`æ–‡ä»¶. 

  

  å’Œ`ppeng-admin`æ–‡ä»¶å¤¹ç›¸åŒç»“æ„çš„è¿˜æœ‰ï¼š

  `ppeng-gateway`,`ppeng-message`,`ppeng-other-api`,`ppeng-recipe`,`ppeng-search`,`ppeng-user` 

- `resource`

  å­˜æ”¾é™æ€èµ„æº

  - `icon`

    å­˜æ”¾ç”¨æˆ·å¤´åƒ

  - `recipe`å­˜æ”¾èœè°±å›¾ç‰‡å’Œèœè°±è§†é¢‘



### ä¾‹å­

> ä¸‹é¢å°†ä»¥`ppeng-module-user`æ¨¡å—ä¸ºä¾‹å°†å…¶jaråŒ…æ‰“åŒ…æˆdockeré•œåƒï¼Œå¹¶è¿è¡Œã€‚

- è¿›å…¥`ppeng-module-user`æ‰€åœ¨çš„ç›®å½•

  ```sh
  cd /home/ppeng/ppeng-user
  ```

- ä¸Šä¼ æ–‡ä»¶

  å°†`ppeng-module-user`æ‰“åŒ…çš„jaråŒ…(`ppeng-module-user-1.0-SNAPSHOT.jar`)å’Œå¯¹åº”çš„[Dockerfile](./data/Dockerfile/ppeng-module-user/Dockerfile)æ–‡ä»¶æ”¾åœ¨è¯¥ç›®å½•ä¸­.

  ç›®å½•ç»“æ„å¦‚ä¸‹ï¼š

  ```sh
  root@czkubuntu:/home/ppeng/ppeng-user# tree
  .
  â”œâ”€â”€ Dockerfile
  â””â”€â”€ ppeng-module-user-1.0-SNAPSHOT.jar
  ```

- æ‰§è¡Œæ„å»ºå‘½ä»¤

  ```sh
  docker build -t ppeng/user:1.0 .
  ```

- æ‰§è¡Œè¿è¡Œå‘½ä»¤

  ```sh
  docker run -d -p 3377:3377 --network ppeng_net --restart=always --name ppeng-user -v /home/ppeng/logs/ppeng-user:/root/logs/ppeng-user  ppeng/user:1.0
  ```

  

ğŸ“¢æ³¨æ„ï¼š

æ¯ä¸ª`Dockerfile`æ–‡ä»¶çš„æœ«å°¾éƒ½åŒ…å«å¯¹åº”çš„æ„å»ºå‘½ä»¤å’Œæ‰§è¡Œå‘½ä»¤ã€‚

ä¾‹å¦‚ï¼š`ppeng-module-user`æ¨¡å—çš„`Dockerfile`æ–‡ä»¶å¦‚ä¸‹ï¼š

```dockerfile
# ppeng-module-user Dockerfileæ–‡ä»¶

FROM openjdk:17

LABEL maintainer="Zaki<cnzakii@gmail.com>"

#å®šä¹‰æ—¶åŒºå‚æ•°
ENV TZ=Asia/Shanghai

#è®¾ç½®æ—¶åŒº
RUN ln -snf /usr/share/zoneinfo/$TZ /etc/localtime && echo '$TZ' > /etc/timezone

#è®¾ç½®ç¼–ç 
ENV LANG C.UTF-8

VOLUME /tmp

WORKDIR /root/

ADD ppeng-module-user-1.0-SNAPSHOT.jar /root/ppeng-user.jar

RUN bash -c 'touch /root/ppeng-user.jar'

ENTRYPOINT ["java","-jar","/root/ppeng-user.jar"]

EXPOSE 3377

# ppeng-module-user æ¨¡å—çš„æ„å»ºå‘½ä»¤å’Œè¿è¡Œå‘½ä»¤ åœ¨è¿™é‡Œï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼

# æ„å»ºå‘½ä»¤
# docker build -t ppeng/user:1.0 .

# è¿è¡Œå‘½ä»¤
# docker run -d -p 3377:3377 --network ppeng_net --restart=always --name ppeng-user -v /home/ppeng/logs/ppeng-user:/root/logs/ppeng-user  ppeng/user:1.0
```

